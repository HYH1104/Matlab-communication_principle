%%%%%%%%%%%%
%fsk调制函数%
%%%%%%%%%%%%
function fskjie=FSKjie(X,f,fs)
%   2FSK解调函数
%   输入接收信号rcv和发送频率[f0 f1]
%   fs为接收信号的采样频率

    Ts=1/fs;
    len=length(X);
    t=0:Ts:(len-1)*Ts;
    %恢复载波
    aid1=cos(2*pi*f(2)*t);
    aid0=cos(2*pi*f(1)*t);  
    %定义滤波器(Fpass=500,Fstop=2k)
    lpf=[-0.000155833996394978,-8.13831647659670e-05,-9.20002718367755e-05,-9.34081381696587e-05,-8.07905288388760e-05,-4.82295684201173e-05,1.10503665725242e-05,0.000104811978995989,0.000241591960167609,0.000430822839276432,0.000682264219483239,0.00100598263039256,0.00141205216632109,0.00191075149567522,0.00251102822992922,0.00322157539693270,0.00404950826762152,0.00500032696122431,0.00607774423655064,0.00728301069263170,0.00861503729572713,0.0100699084385198,0.0116408437704915,0.0133180094004704,0.0150886733499124,0.0169371703821178,0.0188450158385386,0.0207913578208965,0.0227530878451301,0.0247053521313381,0.0266220811202588,0.0284763137354778,0.0302410586230369,0.0318896464873665,0.0333964895832343,0.0347376010424772,0.0358912330554356,0.0368383387237662,0.0375630659622750,0.0380532056874610,0.0383003706934961,0.0383003706934961,0.0380532056874610,0.0375630659622750,0.0368383387237662,0.0358912330554356,0.0347376010424772,0.0333964895832343,0.0318896464873665,0.0302410586230369,0.0284763137354778,0.0266220811202588,0.0247053521313381,0.0227530878451301,0.0207913578208965,0.0188450158385386,0.0169371703821178,0.0150886733499124,0.0133180094004704,0.0116408437704915,0.0100699084385198,0.00861503729572713,0.00728301069263170,0.00607774423655064,0.00500032696122431,0.00404950826762152,0.00322157539693270,0.00251102822992922,0.00191075149567522,0.00141205216632109,0.00100598263039256,0.000682264219483239,0.000430822839276432,0.000241591960167609,0.000104811978995989,1.10503665725242e-05,-4.82295684201173e-05,-8.07905288388760e-05,-9.34081381696587e-05,-9.20002718367755e-05,-8.13831647659670e-05,-0.000155833996394978];
    %滤除高频部分，保留低频分量
    rcv1=filter(lpf,1,X.*aid1);
    rcv0=filter(lpf,1,X.*aid0);
    %归一化
    rcv1=rcv1/max(abs(rcv1));
    rcv0=rcv0/max(abs(rcv0));
    [~,N]=size(rcv0);
    A=[];
    for i=1:N
        if rcv0(i)>0.1
          rcv0(i)=1;
        else
          rcv0(i)=0; 
        end
    end
    for i=1:N/fs
        if rcv0(100*i)>0.5
          A(i)=1;
        else
          A(i)=0; 
        end
    end
    fskjie=A;       
end
